<!DOCTYPE html>
<html lang="es" data-cache-bust="20250113s">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gestor de Casos de Prueba</title>
    <script>
        // Aplicar tema lo antes posible para evitar parpadeo
        (function(){
            try {
                var t = localStorage.getItem('theme') || 'light';
                if (t === 'dark') {
                    document.documentElement.setAttribute('data-theme','dark');
                }
            } catch(e) { /* noop */ }
        })();
    </script>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/dashboard.css?v=20250113s">
</head>

<body>
    <script>
        // Asegurar clase en body inmediatamente
        (function(){
            try {
                if (localStorage.getItem('theme') === 'dark') {
                    document.body.classList.add('dark-mode');
                }
            } catch(e) { /* noop */ }
        })();
    </script>
    <!-- Header del Dashboard -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="header-left">
                <h1>Dashboard de Requerimientos</h1>
                <p class="header-subtitle">Gesti√≥n de Casos de Prueba del Equipo</p>
            </div>
            <div class="header-right">
                <!-- Switch de Tema -->
                <div class="theme-switch-container">
                    <div class="theme-switch">
                        <label class="switch">
                            <input type="checkbox" id="themeToggle">
                            <span class="slider"></span>
                        </label>
                        <span id="themeLabel">Modo Claro</span>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="btnNewRequirement">
                    ‚ûï Nuevo Requerimiento
                </button>
                <button class="btn btn-secondary" id="btnGenerateReport">
                    üìä Generar Reporte
                </button>
                <!-- üîß BOTONES DE DESARROLLO (solo visibles en desarrollo) -->
                <button class="btn btn-info" id="btnForceUpdate" onclick="forceUpdateApp()" style="display: none;">
                    üîÑ Forzar Update
                </button>
                <button class="btn btn-success" id="btnCheckUpdates" onclick="checkUpdatesFallback()" style="display: none;">
                    üîç Verificar Actualizaciones
                </button>
                <!-- Botones de importar/exportar ocultos por ahora -->
                <button class="btn btn-secondary" id="btnExportProject" style="display: none;">
                    üì§ Exportar Proyecto
                </button>
                <button class="btn btn-secondary" id="btnImportProject" style="display: none;">
                    üìÇ Importar Proyecto
                </button>
            </div>
        </div>
    </header>

    <!-- Contenido Principal -->
    <main class="dashboard-main">
        <!-- Filtros y B√∫squeda -->
        <section class="dashboard-filters">
            <div class="filters-container">
                <div class="search-box">
                    <input type="text" id="searchRequirements" placeholder="üîç Buscar requerimientos...">
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">Todos</button>
                    <button class="filter-btn" data-filter="active">Activos</button>
                    <button class="filter-btn" data-filter="completed">Completados</button>
                    <button class="filter-btn" data-filter="paused">Pausados</button>
                </div>
                <div class="sort-options">
                    <select id="sortBy">
                        <option value="priority">Por Prioridad</option>
                        <option value="name">Por Nombre</option>
                        <option value="date">Por Fecha</option>
                        <option value="progress">Por Progreso</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Lista de Requerimientos -->
        <section class="requirements-list">
            <div class="requirements-container" id="requirementsContainer">
                <!-- Los requerimientos se cargar√°n din√°micamente aqu√≠ -->
            </div>
        </section>

        <!-- Estad√≠sticas del Dashboard -->
        <section class="dashboard-stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalRequirements">0</div>
                        <div class="stat-label">Requerimientos</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <div class="stat-number" id="completedRequirements">0</div>
                        <div class="stat-label">Completados</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-content">
                        <div class="stat-number" id="activeRequirements">0</div>
                        <div class="stat-label">En Progreso</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üö´</div>
                    <div class="stat-content">
                        <div class="stat-number" id="blockedRequirements">0</div>
                        <div class="stat-label">Bloqueados</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal para Nuevo Requerimiento -->
    <div id="newRequirementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Nuevo Requerimiento</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="newRequirementForm">
                    <div class="form-group">
                        <label for="reqNumber">N√∫mero de Requerimiento:</label>
                        <input type="text" id="reqNumber" required placeholder="REQ-001">
                    </div>
                    <div class="form-group">
                        <label for="reqName">Nombre:</label>
                        <input type="text" id="reqName" required placeholder="Nombre del requerimiento">
                    </div>
                    <div class="form-group">
                        <label for="reqDescription">Descripci√≥n:</label>
                        <textarea id="reqDescription" rows="3" placeholder="Descripci√≥n detallada del requerimiento"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="reqPriority">Prioridad:</label>
                        <select id="reqPriority" required>
                            <option value="1">1 - Cr√≠tica (Rojo)</option>
                            <option value="2">2 - Alta (Naranja)</option>
                            <option value="3">3 - Media (Amarillo)</option>
                            <option value="4">4 - Normal (Verde)</option>
                            <option value="5">5 - Baja (Azul)</option>
                            <option value="6">6 - Muy Baja (Violeta)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reqTester">Tester Asignado:</label>
                        <input type="text" id="reqTester" placeholder="Nombre del tester">
                    </div>
                    <div class="form-group">
                        <label for="reqStartDate">Fecha de Inicio:</label>
                        <input type="date" id="reqStartDate">
                    </div>
                    <div class="form-group">
                        <label for="reqStatus">Estado:</label>
                        <select id="reqStatus">
                            <option value="active">Activo</option>
                            <option value="completed">Completado</option>
                            <option value="paused">Pausado</option>
                            <option value="blocked">Bloqueado</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelNewReq">Cancelar</button>
                <button type="submit" class="btn btn-primary" form="newRequirementForm">Crear Requerimiento</button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Requerimiento -->
    <div id="editRequirementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Requerimiento</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editRequirementForm">
                    <div class="form-group">
                        <label for="editReqNumber">N√∫mero de Requerimiento:</label>
                        <input type="text" id="editReqNumber" required placeholder="REQ-001">
                    </div>
                    <div class="form-group">
                        <label for="editReqName">Nombre:</label>
                        <input type="text" id="editReqName" required placeholder="Nombre del requerimiento">
                    </div>
                    <div class="form-group">
                        <label for="editReqDescription">Descripci√≥n:</label>
                        <textarea id="editReqDescription" rows="3" placeholder="Descripci√≥n detallada del requerimiento"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editReqPriority">Prioridad:</label>
                        <select id="editReqPriority" required>
                            <option value="1">1 - Cr√≠tica (Rojo)</option>
                            <option value="2">2 - Alta (Naranja)</option>
                            <option value="3">3 - Media (Amarillo)</option>
                            <option value="4">4 - Normal (Verde)</option>
                            <option value="5">5 - Baja (Azul)</option>
                            <option value="6">6 - Muy Baja (Violeta)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editReqTester">Tester Asignado:</label>
                        <input type="text" id="editReqTester" placeholder="Nombre del tester">
                    </div>
                    <div class="form-group">
                        <label for="editReqStartDate">Fecha de Inicio:</label>
                        <input type="date" id="editReqStartDate">
                    </div>
                    <div class="form-group">
                        <label for="editReqStatus">Estado:</label>
                        <select id="editReqStatus">
                            <option value="active">Activo</option>
                            <option value="completed">Completado</option>
                            <option value="paused">Pausado</option>
                            <option value="blocked">Bloqueado</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelEditReq">Cancelar</button>
                <button type="submit" class="btn btn-primary" form="editRequirementForm">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- Modal de Reporte Ejecutivo - NUEVO DISE√ëO -->
    <div id="reportModal" class="modal">
        <div class="modal-content report-modal-new">
            <div class="modal-header">
                <h2>üìä Reporte Ejecutivo</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="report-controls">
                    <div class="selection-controls">
                        <button class="btn btn-sm" id="selectAllRequirements">Seleccionar Todos</button>
                        <button class="btn btn-sm" id="deselectAllRequirements">Deseleccionar Todos</button>
                        <span class="selection-count">Seleccionados: <span id="selectedCount">0</span></span>
                    </div>
                </div>
                
                <div class="report-content-new">
                    <!-- üÜï RESUMEN EJECUTIVO - DISE√ëO LIMPIO -->
                    <div class="executive-summary-new" id="executiveSummary">
                        <h3>üéØ Resumen Ejecutivo</h3>
                        
                        <!-- Primera fila: Estad√≠sticas principales -->
                        <div class="summary-row">
                            <div class="summary-card-new">
                                <div class="summary-number-new" id="totalSelected">0</div>
                                <div class="summary-label-new">Requerimientos</div>
                            </div>
                            <div class="summary-card-new">
                                <div class="summary-number-new" id="totalTime">0</div>
                                <div class="summary-label-new">Horas Totales</div>
                            </div>
                            <div class="summary-card-new">
                                <div class="summary-number-new" id="successRate">0%</div>
                                <div class="summary-label-new">Tasa de √âxito</div>
                            </div>
                            <div class="summary-card-new">
                                <div class="summary-number-new" id="totalScenarios">0</div>
                                <div class="summary-label-new">Escenarios</div>
                            </div>
                        </div>
                        
                        <!-- Segunda fila: Estad√≠sticas de bugs -->
                        <div class="summary-row">
                            <div class="summary-card-new">
                                <div class="summary-number-new" id="totalBugsReported">0</div>
                                <div class="summary-label-new">Bugs Reportados</div>
                            </div>
                            <div class="summary-card-new">
                                <div class="summary-number-new" id="totalBugsFixed">0</div>
                                <div class="summary-label-new">Bugs Arreglados</div>
                            </div>
                            <div class="summary-card-new">
                                <div class="summary-number-new" id="totalBugsPending">0</div>
                                <div class="summary-label-new">Bugs Pendientes</div>
                            </div>
                            <div class="summary-card-new placeholder"></div>
                        </div>
                    </div>
                    
                    <!-- üÜï VISTA DETALLADA - TABLA LIMPIA -->
                    <div class="detailed-view-new" id="detailedView">
                        <h3>üìã Detalle por Requerimiento</h3>
                        <div class="report-table-new" id="reportTable">
                            <!-- Se llenar√° din√°micamente -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="exportToPDF">üìÑ Exportar PDF</button>
                <button class="btn btn-primary" id="closeReportModal">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Librer√≠a de compresi√≥n -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    
    <!-- Funciones de compresi√≥n -->
    <!-- UTILITIES -->
    <script src="js/utils/compression-utils.js?v=20250111b"></script>
    
    <!-- UI -->
    <script src="js/ui/toast-system.js?v=20250111b"></script>
    
    <!-- UPDATE SYSTEM (Automatic updates) -->
    <script src="js/version-manager.js?v=20250112a"></script>
    <script src="js/update-manager.js?v=20250112d"></script>
    
    <!-- DASHBOARD -->
    <script src="js/dashboard/dashboard-theme.js?v=20250110a"></script>
    <script src="js/dashboard/dashboard-storage.js?v=20250110a"></script>
    <script src="js/dashboard/dashboard-core.js?v=20250113a"></script>
    <script src="js/dashboard/dashboard-ui.js?v=20250113s"></script>
    <script>
        // Warm-up IndexedDB en dashboard sin bloquear
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(async () => {
                if (window.IndexedDBManager && window.IndexedDBManager.init) {
                    try { await Promise.race([
                        window.IndexedDBManager.init(),
                        new Promise(res => setTimeout(res, 1200))
                    ]);} catch(e){ /* noop */ }
                }
            }, 200);
        });
    </script>
    
    <!-- üîß DETECCI√ìN DE ENTORNO -->
    <script>
        // Detectar si estamos en desarrollo o producci√≥n
        window.isDevelopment = window.location.hostname === 'localhost' || 
                              window.location.hostname === '127.0.0.1' || 
                              window.location.hostname.includes('dev') ||
                              window.location.protocol === 'file:';
        
        console.log('üîç Entorno detectado:', window.isDevelopment ? 'DESARROLLO' : 'PRODUCCI√ìN');
        console.log('üåê Hostname:', window.location.hostname);
        console.log('üîí Protocolo:', window.location.protocol);
    </script>
    
    <!-- üîß HERRAMIENTAS DE DESARROLLO -->
    <script src="js/utils/dev-tools.js?v=20250113a"></script>
    
    <!-- CORE -->
    <script src="js/core/sync-manager.js?v=20250112a"></script>
    
    <!-- LEGACY -->
    <script src="js/legacy/data-migration.js?v=20250110a"></script>

    <!-- Footer con informaci√≥n de versi√≥n -->
    <footer class="app-footer">
        <div class="version-info">
            <div id="version-display" class="version-display"></div>
        </div>
    </footer>

    <style>
        .app-footer {
            background: linear-gradient(135deg, #1e293b, #334155);
            border-top: 1px solid #475569;
            padding: 8px 16px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            margin-top: auto;
        }

        .version-info {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .version-display {
            font-size: 12px;
            color: #94a3b8;
            text-align: center;
            font-family: 'Segoe UI', sans-serif;
        }

        .version-display .version-info {
            margin: 0;
            padding: 2px 8px;
            background: rgba(148, 163, 184, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        /* Dark mode support */
        [data-theme="dark"] .app-footer {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            border-top-color: #334155;
        }

        [data-theme="dark"] .version-display {
            color: #64748b;
        }

        [data-theme="dark"] .version-display .version-info {
            background: rgba(100, 116, 139, 0.1);
            border-color: rgba(100, 116, 139, 0.2);
        }

        /* Ajustar el contenido principal para que no se superponga con el footer */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
    </style>
</body>

</html>
